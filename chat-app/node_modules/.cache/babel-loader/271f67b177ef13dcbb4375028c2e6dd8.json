{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Walid/Documents/Real time chat application using MERN stack/chat-app/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/Walid/Documents/Real time chat application using MERN stack/chat-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Walid/Documents/Real time chat application using MERN stack/chat-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect,useRef}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import ChatContainer from'../styled-components/ChatContainer';import{allUsersRoute,host}from'../utils/APIRoutes';import Contacts from'../components/Contacts';import Welcome from'../components/Welcome';import Messaging from'../components/Messaging';import{io}from'socket.io-client';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(){var socket=useRef();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),contacts=_useState2[0],setContacts=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useState5=useState(undefined),_useState6=_slicedToArray(_useState5,2),currentChat=_useState6[0],setCurrentChat=_useState6[1];var navigate=useNavigate();useEffect(function(){var getCurrentUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var user,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:user=localStorage.getItem('user');if(user){_context.next=5;break;}navigate('/login');_context.next=9;break;case 5:_context.next=7;return JSON.parse(user);case 7:data=_context.sent;setCurrentUser(data);case 9:case\"end\":return _context.stop();}}},_callee);}));return function getCurrentUser(){return _ref.apply(this,arguments);};}();getCurrentUser();},[navigate]);useEffect(function(){if(currentUser){socket.current=io(host);socket.current.emit('add-user',currentUser._id);}},[currentUser]);useEffect(function(){var getContacts=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!currentUser){_context2.next=9;break;}if(!currentUser.isAvatarImageSet){_context2.next=8;break;}_context2.next=4;return axios.get(\"\".concat(allUsersRoute,\"/\").concat(currentUser._id));case 4:data=_context2.sent;setContacts(data.data);_context2.next=9;break;case 8:navigate('/setAvatar');case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function getContacts(){return _ref2.apply(this,arguments);};}();getContacts();},[currentUser,navigate]);var handleChatChange=function handleChatChange(chat){setCurrentChat(chat);};return/*#__PURE__*/_jsx(ChatContainer,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsx(Contacts,{contacts:contacts,currentUser:currentUser,changeChat:handleChatChange}),currentChat===undefined?/*#__PURE__*/_jsx(Welcome,{currentUser:currentUser}):/*#__PURE__*/_jsx(Messaging,{currentChat:currentChat,currentUser:currentUser,socket:socket})]})});};export default Chat;","map":{"version":3,"names":["useState","useEffect","useRef","axios","useNavigate","ChatContainer","allUsersRoute","host","Contacts","Welcome","Messaging","io","Chat","socket","contacts","setContacts","undefined","currentUser","setCurrentUser","currentChat","setCurrentChat","navigate","getCurrentUser","user","localStorage","getItem","JSON","parse","data","current","emit","_id","getContacts","isAvatarImageSet","get","handleChatChange","chat"],"sources":["C:/Users/Walid/Documents/Real time chat application using MERN stack/chat-app/src/pages/Chat.jsx"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\nimport axios from 'axios';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ChatContainer from '../styled-components/ChatContainer';\r\nimport { allUsersRoute, host } from '../utils/APIRoutes';\r\nimport Contacts from '../components/Contacts';\r\nimport Welcome from '../components/Welcome';\r\nimport Messaging from '../components/Messaging';\r\nimport { io } from 'socket.io-client';\r\n\r\n\r\nconst Chat = () => {\r\n\r\n    const socket = useRef();\r\n\r\n    const [contacts, setContacts] = useState([]);\r\n\r\n    const [currentUser, setCurrentUser] = useState(undefined);\r\n\r\n    const [currentChat, setCurrentChat] = useState(undefined);\r\n\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const getCurrentUser = async () => {\r\n            const user = localStorage.getItem('user');\r\n            if (!user)\r\n                navigate('/login');\r\n            else {\r\n                const data = await JSON.parse(user);\r\n                setCurrentUser(data);\r\n            }\r\n        };\r\n        getCurrentUser();\r\n    }, [navigate]);\r\n\r\n    useEffect(() => {\r\n        if (currentUser) {\r\n            socket.current = io(host);\r\n            socket.current.emit('add-user', currentUser._id);\r\n        }\r\n    }, [currentUser]);\r\n\r\n    useEffect(() => {\r\n        const getContacts = async () => {\r\n            if (currentUser) {\r\n                if (currentUser.isAvatarImageSet) {\r\n                    const data = await axios.get(`${allUsersRoute}/${currentUser._id}`);\r\n                    setContacts(data.data);\r\n                }\r\n                else {\r\n                    navigate('/setAvatar');\r\n                }\r\n            }\r\n        };\r\n        getContacts();\r\n    }, [currentUser, navigate]);\r\n\r\n    const handleChatChange = chat => {\r\n        setCurrentChat(chat);\r\n    };\r\n\r\n    return (\r\n        <ChatContainer>\r\n            <div className='container'>\r\n                <Contacts\r\n                    contacts={contacts}\r\n                    currentUser={currentUser}\r\n                    changeChat={handleChatChange}\r\n                />\r\n                {\r\n                    currentChat === undefined ? (\r\n                        <Welcome\r\n                            currentUser={currentUser}\r\n                        />\r\n                    ) : (\r\n                        <Messaging\r\n                            currentChat={currentChat}\r\n                            currentUser={currentUser}\r\n                            socket={socket}\r\n                        />\r\n                    )\r\n                }\r\n            </div>\r\n        </ChatContainer>\r\n    )\r\n};\r\n\r\nexport default Chat;"],"mappings":"yfAAA,OAASA,QAAT,CAAmBC,SAAnB,CAA8BC,MAA9B,KAA4C,OAA5C,CACA,MAAOC,MAAP,KAAkB,OAAlB,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,MAAOC,cAAP,KAA0B,oCAA1B,CACA,OAASC,aAAT,CAAwBC,IAAxB,KAAoC,oBAApC,CACA,MAAOC,SAAP,KAAqB,wBAArB,CACA,MAAOC,QAAP,KAAoB,uBAApB,CACA,MAAOC,UAAP,KAAsB,yBAAtB,CACA,OAASC,EAAT,KAAmB,kBAAnB,C,wFAGA,GAAMC,KAAI,CAAG,QAAPA,KAAO,EAAM,CAEf,GAAMC,OAAM,CAAGX,MAAM,EAArB,CAEA,cAAgCF,QAAQ,CAAC,EAAD,CAAxC,wCAAOc,QAAP,eAAiBC,WAAjB,eAEA,eAAsCf,QAAQ,CAACgB,SAAD,CAA9C,yCAAOC,WAAP,eAAoBC,cAApB,eAEA,eAAsClB,QAAQ,CAACgB,SAAD,CAA9C,yCAAOG,WAAP,eAAoBC,cAApB,eAEA,GAAMC,SAAQ,CAAGjB,WAAW,EAA5B,CAEAH,SAAS,CAAC,UAAM,CACZ,GAAMqB,eAAc,4FAAG,mJACbC,IADa,CACNC,YAAY,CAACC,OAAb,CAAqB,MAArB,CADM,IAEdF,IAFc,yBAGfF,QAAQ,CAAC,QAAD,CAAR,CAHe,mDAKIK,KAAI,CAACC,KAAL,CAAWJ,IAAX,CALJ,QAKTK,IALS,eAMfV,cAAc,CAACU,IAAD,CAAd,CANe,sDAAH,kBAAdN,eAAc,0CAApB,CASAA,cAAc,GACjB,CAXQ,CAWN,CAACD,QAAD,CAXM,CAAT,CAaApB,SAAS,CAAC,UAAM,CACZ,GAAIgB,WAAJ,CAAiB,CACbJ,MAAM,CAACgB,OAAP,CAAiBlB,EAAE,CAACJ,IAAD,CAAnB,CACAM,MAAM,CAACgB,OAAP,CAAeC,IAAf,CAAoB,UAApB,CAAgCb,WAAW,CAACc,GAA5C,EACH,CACJ,CALQ,CAKN,CAACd,WAAD,CALM,CAAT,CAOAhB,SAAS,CAAC,UAAM,CACZ,GAAM+B,YAAW,6FAAG,uJACZf,WADY,8BAERA,WAAW,CAACgB,gBAFJ,iDAGW9B,MAAK,CAAC+B,GAAN,WAAa5B,aAAb,aAA8BW,WAAW,CAACc,GAA1C,EAHX,QAGFH,IAHE,gBAIRb,WAAW,CAACa,IAAI,CAACA,IAAN,CAAX,CAJQ,8BAORP,QAAQ,CAAC,YAAD,CAAR,CAPQ,wDAAH,kBAAXW,YAAW,2CAAjB,CAWAA,WAAW,GACd,CAbQ,CAaN,CAACf,WAAD,CAAcI,QAAd,CAbM,CAAT,CAeA,GAAMc,iBAAgB,CAAG,QAAnBA,iBAAmB,CAAAC,IAAI,CAAI,CAC7BhB,cAAc,CAACgB,IAAD,CAAd,CACH,CAFD,CAIA,mBACI,KAAC,aAAD,wBACI,aAAK,SAAS,CAAC,WAAf,wBACI,KAAC,QAAD,EACI,QAAQ,CAAEtB,QADd,CAEI,WAAW,CAAEG,WAFjB,CAGI,UAAU,CAAEkB,gBAHhB,EADJ,CAOQhB,WAAW,GAAKH,SAAhB,cACI,KAAC,OAAD,EACI,WAAW,CAAEC,WADjB,EADJ,cAKI,KAAC,SAAD,EACI,WAAW,CAAEE,WADjB,CAEI,WAAW,CAAEF,WAFjB,CAGI,MAAM,CAAEJ,MAHZ,EAZZ,GADJ,EADJ,CAwBH,CA3ED,CA6EA,cAAeD,KAAf"},"metadata":{},"sourceType":"module"}